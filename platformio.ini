; PlatformIO Project Configuration File
; MeshCore Companion for Heltec V3
[env:heltec_v3]
platform = espressif32@6.5.0
board = heltec_wifi_lora_32_V3
framework = arduino

; Monitor settings
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Upload settings
upload_speed = 921600

; Build flags for Heltec V3 / MeshCore
build_flags = 
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=0
    -DCORE_DEBUG_LEVEL=0
    
    ; RadioLib configuration - GODMODE required for MeshCore access to private members
    -DRADIOLIB_STATIC_ONLY=1
    -DRADIOLIB_GODMODE=1
    
    ; Exclude unused RadioLib modules to reduce code size
    -DRADIOLIB_EXCLUDE_CC1101=1
    -DRADIOLIB_EXCLUDE_RF69=1
    -DRADIOLIB_EXCLUDE_SX1231=1
    -DRADIOLIB_EXCLUDE_SI443X=1
    -DRADIOLIB_EXCLUDE_RFM2X=1
    -DRADIOLIB_EXCLUDE_SX128X=1
    -DRADIOLIB_EXCLUDE_AFSK=1
    -DRADIOLIB_EXCLUDE_AX25=1
    -DRADIOLIB_EXCLUDE_HELLSCHREIBER=1
    -DRADIOLIB_EXCLUDE_MORSE=1
    -DRADIOLIB_EXCLUDE_APRS=1
    -DRADIOLIB_EXCLUDE_BELL=1
    -DRADIOLIB_EXCLUDE_RTTY=1
    -DRADIOLIB_EXCLUDE_SSTV=1
    
    ; LoRa Radio Configuration for Heltec V3 (SX1262)
    -DP_LORA_NSS=8
    -DP_LORA_DIO_1=14
    -DP_LORA_RESET=12
    -DP_LORA_BUSY=13
    -DP_LORA_SCLK=9
    -DP_LORA_MISO=11
    -DP_LORA_MOSI=10
    -DSX126X_DIO2_AS_RF_SWITCH=true
    -DSX126X_DIO3_TCXO_VOLTAGE=1.8
    
    ; Radio class definitions for MeshCore
    -DRADIO_CLASS=CustomSX1262
    -DWRAPPER_CLASS=CustomSX1262Wrapper
    
    ; Board Configuration
    -DPIN_VBAT_READ=1
    -DPIN_ADC_CTRL=37
    -DPIN_VEXT_EN=36
    -DPIN_USER_BTN=0
    
    ; LoRa Default Parameters - EU868 Long Range
    -DLORA_FREQ=869.617
    -DLORA_BW=62.50
    -DLORA_SF=8
    -DLORA_CR=8
    -DLORA_TX_POWER=22
    
    ; MeshCore Configuration
    -DMAX_CONTACTS=32
    -DMAX_GROUP_CHANNELS=4
    
    ; Firmware info
    -DFIRMWARE_VERSION='"1.0.0"'
    -DFIRMWARE_BUILD_DATE='"2026-01-07"'
    
    ; Include path for the Heltec V3 variant (for target.h) and MeshCore lib headers
    -I.pio/libdeps/heltec_v3/MeshCore/variants/heltec_v3
    -I.pio/libdeps/heltec_v3/MeshCore/lib/ed25519

; Library dependencies
lib_deps = 
    https://github.com/meshcore-dev/MeshCore.git#companion-v1.11.0
    jgromes/RadioLib@^7.3.0
    rweather/Crypto@^0.4.0
    densaugeo/base64@~1.4.0
    olikraus/U8g2@^2.35.9

; Force RadioLib version (override MeshCore's dependency)
lib_ldf_mode = chain+

; Partition scheme for OTA updates
board_build.partitions = default.csv

; Extra source files to compile - include the variant's target.cpp
build_src_filter = 
    +<*>
    +<../.pio/libdeps/heltec_v3/MeshCore/variants/heltec_v3/target.cpp>
